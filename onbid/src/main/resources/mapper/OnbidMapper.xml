<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pci.onbid.mapper.OnbidMapper">

    <!-- ✅ DB 저장용 -->
    <insert id="insert" parameterType="com.pci.onbid.domain.OnbidItem">
        INSERT IGNORE onbid_item (
        plnm_no, cltr_nm, ldnm_adrs,
        min_bid_prc, apsl_ases_avg_amt,
        pbct_begn_dtm, pbct_cls_dtm,
        pbct_cltr_stat_nm, sido, created_at
        )
        VALUES (
        #{plnmNo}, #{cltrNm}, #{ldnmAdrs},
        #{minBidPrc}, #{apslAsesAvgAmt},
        #{pbctBegnDtm}, #{pbctClsDtm},
        #{pbctCltrStatNm}, #{sido}, NOW()
        )
    </insert>

    <!-- ✅ 프론트 목록 조회 -->
    <select id="findAll" resultType="com.pci.onbid.domain.OnbidItem">
        SELECT
        id,
        plnm_no AS plnmNo,
        cltr_nm AS cltrNm,
        ldnm_adrs AS ldnmAdrs,
        min_bid_prc AS minBidPrc,
        apsl_ases_avg_amt AS apslAsesAvgAmt,
        pbct_begn_dtm AS pbctBegnDtm,
        pbct_cls_dtm AS pbctClsDtm,
        pbct_cltr_stat_nm AS pbctCltrStatNm,
        sido,
        created_at AS regDate
        FROM onbid_item
        ORDER BY id DESC
    </select>

    <!-- ✅ 검색용 -->
    <select id="search" parameterType="string" resultType="com.pci.onbid.domain.OnbidItem">
        SELECT
        id,
        plnm_no AS plnmNo,
        cltr_nm AS cltrNm,
        ldnm_adrs AS ldnmAdrs,
        min_bid_prc AS minBidPrc,
        apsl_ases_avg_amt AS apslAsesAvgAmt,
        pbct_begn_dtm AS pbctBegnDtm,
        pbct_cls_dtm AS pbctClsDtm,
        pbct_cltr_stat_nm AS pbctCltrStatNm,
        sido,
        created_at AS regDate
        FROM onbid_item
        WHERE cltr_nm LIKE CONCAT('%', #{keyword}, '%')
        OR ldnm_adrs LIKE CONCAT('%', #{keyword}, '%')
        OR sido LIKE CONCAT('%', #{keyword}, '%')
        ORDER BY id DESC
    </select>

</mapper>
